"use strict";function getAbortController(){var o=getAbortSignal(),t=function(t){o.aborted||(o.aborted=!0,o.dispatchEvent(t))};return{signal:o,abort:t}}function getAbortSignal(){var o={aborted:!1,onabort:null};return o.dispatchEvent=function(t){"function"==typeof o.onabort&&o.onabort(t)},o}function AbortablePromise(o,t){this.promise=new Promise(function(r,e){t||(t=getAbortController()),o(r,e,t.signal)}),this.abortController=t}function setPromisesAbort(o,t){t.onabort=function(t){o.forEach(function(o){o instanceof AbortablePromise&&o.abort(t).catch(function(){})})}}AbortablePromise.prototype=new Promise(function(){}),AbortablePromise.prototype.constructor=AbortablePromise,AbortablePromise.prototype.then=function(o,t){var r=this;return new AbortablePromise(function(e,n,i){var b=function(o,t,r){if("function"==typeof r){if((t=r(t))instanceof AbortablePromise){var b=t.abortController.signal;i.aborted=b.aborted,i.onabort=b.onabort}return e(t)}"resolved"===o&&e(t),"rejected"===o&&n(t)};r.promise.then(function(t){b("resolved",t,o)},function(o){b("rejected",o,t)})},this.abortController)},AbortablePromise.prototype.catch=function(o){return this.then(null,o)},AbortablePromise.prototype.abort=function(o){var t=this;return new AbortablePromise(function(r,e){Promise.resolve().then(function(){t.abortController.abort(o),t.then(r,e)})},this.abortController)},AbortablePromise.resolve=function(o){return new AbortablePromise(function(t,r){t(o)})},AbortablePromise.reject=function(o){return new AbortablePromise(function(t,r){r(o)})},AbortablePromise.all=function(o){return new AbortablePromise(function(t,r,e){setPromisesAbort(o,e),Promise.all(o).then(t,r)})},AbortablePromise.race=function(o){return new AbortablePromise(function(t,r,e){setPromisesAbort(o,e),Promise.race(o).then(t,r)})},module.exports=AbortablePromise;
