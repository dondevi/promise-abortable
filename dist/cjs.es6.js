"use strict";function getAbortController(){var t=getAbortSignal(),o=function(o){t.aborted||(t.aborted=!0,t.dispatchEvent(o))};return{signal:t,abort:o}}function getAbortSignal(){var t={aborted:!1,onabort:null};return t.dispatchEvent=function(o){"function"==typeof t.onabort&&t.onabort(o)},t}function setPromisesAbort(t,o){o.onabort=(o=>{t.forEach(t=>{t instanceof AbortablePromise&&t.abort(o).catch(t=>t)})})}class AbortablePromise extends Promise{constructor(t,o=getAbortController()){super((n,r)=>{t(n,r,o.signal)}),this.abortController=o}then(t,o){return new AbortablePromise((n,r,e)=>{const i=(t,o,i)=>{if("function"==typeof i)return(o=i(o))instanceof AbortablePromise&&Object.assign(e,o.abortController.signal),n(o);"resolved"===t&&n(o);"rejected"===t&&r(o)};super.then(o=>i("resolved",o,t),t=>i("rejected",t,o))},this.abortController)}abort(t){return new AbortablePromise((o,n)=>{Promise.resolve().then(()=>{this.abortController.abort(t);this.then(o,n)})},this.abortController)}static all(t){return new AbortablePromise((o,n,r)=>{setPromisesAbort(t,r);Promise.all(t).then(o,n)})}static race(t){return new AbortablePromise((o,n,r)=>{setPromisesAbort(t,r);Promise.race(t).then(o,n)})}}module.exports=AbortablePromise;
